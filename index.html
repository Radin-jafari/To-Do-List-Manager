{% extends "base.html" %}

{% block content %}

<section class="top-bar card">
    <form class="search-form" method="get" action="{{ url_for('index') }}">
        <div class="input-with-label">
            <span class="input-label">Search</span>
            <div class="input-wrapper">
                <span class="input-icon">üîç</span>
                <input
                    type="text"
                    name="q"
                    placeholder="Find tasks by title, description, or category‚Ä¶"
                    value="{{ search }}"
                >
            </div>
        </div>
        <button type="submit" class="btn primary">Search</button>
    </form>

    <div class="filters">
        <span class="filters-label">View:</span>

        <a href="{{ url_for('index', filter='active', q=search) }}"
           class="chip-filter {% if filter_status == 'active' %}active{% endif %}">
            Active
        </a>

        <a href="{{ url_for('index', filter='done', q=search) }}"
           class="chip-filter {% if filter_status == 'done' %}active{% endif %}">
            Completed
        </a>

        <a href="{{ url_for('index', filter='all', q=search) }}"
           class="chip-filter {% if filter_status == 'all' %}active{% endif %}">
            All
        </a>
    </div>
</section>

<section class="new-task card">
    <div class="card-header-row">
        <h2>Add a new task</h2>
        <span class="card-hint">Keep it small and realistic. Tiny tasks are easier to finish.</span>
    </div>

    <form action="{{ url_for('add') }}" method="post" class="task-form">
        <div class="row">
            <div class="input-with-label full">
                <span class="input-label">Title</span>
                <input
                    type="text"
                    name="title"
                    placeholder="e.g. Work on CS50 final project"
                    required
                >
            </div>
        </div>

        <div class="row">
            <div class="input-with-label full">
                <span class="input-label">Description (optional)</span>
                <textarea
                    name="description"
                    rows="2"
                    placeholder="Add a few details if it helps you remember what to do."
                ></textarea>
            </div>
        </div>

        <div class="row">
            <div class="input-with-label">
                <span class="input-label">Category</span>
                <input
                    type="text"
                    name="category"
                    placeholder="e.g. University, Personal, Work"
                >
            </div>

            <div class="input-with-label">
                <span class="input-label">Priority</span>
                <select name="priority">
                    <option value="1">High üî•</option>
                    <option value="2" selected>Normal üôÇ</option>
                    <option value="3">Low üòå</option>
                </select>
            </div>

            <div class="input-with-label">
                <span class="input-label">Due date</span>
                <input type="date" name="due_date">
            </div>
        </div>

        <div class="row actions-row">
            <button type="submit" class="btn primary">Add task</button>
        </div>
    </form>
</section>

<section class="tasks card">
    <div class="card-header-row">
        <h2>Your tasks</h2>
        <span class="card-hint">
            Click ‚ÄúMark as done‚Äù when you finish something. It feels better than you think.
        </span>
    </div>

    {% if not tasks %}
        <p class="empty-state">
            You don‚Äôt have any tasks in this view yet. Add a small, 2-minute task to get started.
        </p>
    {% else %}
        <ul class="task-list">
            {% for task in tasks %}
                <li class="task-item {% if task['done'] %}done{% endif %}">
                    <div class="task-status-strip">
                        {% if task["done"] %}
                            <span class="status-dot done-dot"></span>
                        {% else %}
                            <span class="status-dot active-dot"></span>
                        {% endif %}
                    </div>

                    <div class="task-main">
                        <div class="task-title-row">
                            <h3>{{ task["title"] }}</h3>

                            {% if task["category"] %}
                                <span class="chip category">{{ task["category"] }}</span>
                            {% endif %}

                            {% if task["priority"] == 1 %}
                                <span class="chip priority high">High</span>
                            {% elif task["priority"] == 2 %}
                                <span class="chip priority normal">Normal</span>
                            {% else %}
                                <span class="chip priority low">Low</span>
                            {% endif %}

                            {% if task["done"] %}
                                <span class="chip done-label">Completed ‚úî</span>
                            {% endif %}
                        </div>

                        {% if task["description"] %}
                            <p class="task-desc">{{ task["description"] }}</p>
                        {% endif %}

                        <div class="task-meta">
                            {% if task["due_date"] %}
                                <span class="meta-item">Due: {{ task["due_date"] }}</span>
                            {% endif %}
                            {% if task["created_at"] %}
                                <span class="meta-item meta-faded">
                                    Created: {{ task["created_at"][:10] }}
                                </span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="task-actions">
                        <a href="{{ url_for('toggle', task_id=task['id']) }}"
                           class="btn secondary">
                            {% if task["done"] %}
                                Mark as not done
                            {% else %}
                                Mark as done
                            {% endif %}
                        </a>

                        <a href="{{ url_for('edit', task_id=task['id']) }}"
                           class="btn ghost">
                            Edit
                        </a>

                        <a href="{{ url_for('delete', task_id=task['id']) }}"
                           class="btn danger"
                           onclick="return confirm('Delete this task?');">
                            Delete
                        </a>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
</section>

{% endblock %}
